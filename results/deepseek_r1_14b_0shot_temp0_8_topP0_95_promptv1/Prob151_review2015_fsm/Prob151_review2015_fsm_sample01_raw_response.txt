always @(posedge clk) begin
    if (reset)
        state <= START;
    else begin
        case (state)
            START:
                if ((data == 1101) && !shifted_in_progress) begin
                    state <= FOUND;
                end
            FOUND:
                state <= SHIFTED;
            SHIFTED:
                state <= COUNTING;
            COUNTING:
                if (done_counting) begin
                    done <= 1;
                    state <= DONE;
                end
            DONE:
                if (ack) begin
                    state <= START;
                    done <= 0;
                end
        endcase
    end

    case (state)
        FOUND:
            shift_ena <= 1;
        SHIFTED, COUNTING, DONE:
           