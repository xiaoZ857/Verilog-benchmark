 ```verilog
always @(posedge clk or posedge load) begin
    if (load)
        q <= data;
    else begin
        for (int i = 0; i < 512; i = i + 1) begin
            if ((i > 0) && (q[i-1] == 1))
                q[i] <= (q[i-1] == q[i]) ^ (q[i] == q[i+1]);
            else if (i < 511)
                q[i] <= q[i];
        end
    end
end
```